0. Before each step put device into flash-mode using the following steps:

Putting device into flash-mode
a) Connect FTDI (GND, RX, TX)
b) Press button
c) Connect +3.3V
d) Release button after ~2secs

1. Backup original firmware (esptool.py from: https://github.com/espressif/esptool.git)

$ esptool --port /dev/ttyUSB0 read_flash 0x00000 0x100000 sonoff-backup.bin
esptool.py v2.8-dev
Serial port /dev/ttyUSB0
Connecting....
Detecting chip type... ESP8266
Chip is ESP8285
Features: WiFi, Embedded Flash
Crystal is 26MHz
MAC: dc:4f:22:93:26:d5
Uploading stub...
Running stub...
Stub running...
1048576 (100 %)
1048576 (100 %)
Read 1048576 bytes at 0x0 in 98.2 seconds (85.4 kbit/s)...
Hard resetting via RTS pin...

2. Erase firmware

$ esptool --port /dev/ttyUSB0 erase_flash
esptool.py v2.8-dev
Serial port /dev/ttyUSB0
Connecting....
Detecting chip type... ESP8266
Chip is ESP8285
Features: WiFi, Embedded Flash
Crystal is 26MHz
MAC: dc:4f:22:93:26:d5
Uploading stub...
Running stub...
Stub running...
Erasing flash (this may take a while)...
Chip erase completed successfully in 3.2s
Hard resetting via RTS pin...

3a. Flash the new firmware (from: https://github.com/arendst/Tasmota/releases)

$ esptool --port /dev/ttyUSB0 write_flash -fs 4MB -fm dout 0x0 tasmota-sensors.bin
esptool.py v2.8-dev
Serial port /dev/ttyUSB0
Connecting....
Detecting chip type... ESP8266
Chip is ESP8285
Features: WiFi, Embedded Flash
Crystal is 26MHz
MAC: dc:4f:22:93:26:d5
Uploading stub...
Running stub...
Stub running...
Configuring flash size...
Compressed 515872 bytes to 355877...
Wrote 515872 bytes (355877 compressed) at 0x00000000 in 31.6 seconds (effective 130.5 kbit/s)...
Hash of data verified.

Leaving...
Hard resetting via RTS pin...

3b. Flash ESP32

$ esptool --chip esp32 --baud 921600 --before default_reset --after hard_reset write_flash -z --flash_mode dout --flash_size detect 0x0 .pio/build/tasmota32/firmware.factory.bin
esptool.py v3.2
Found 1 serial ports
Serial port /dev/ttyUSB0
Connecting....
Chip is ESP32-D0WDQ6 (revision 1)
Features: WiFi, BT, Dual Core, 240MHz, VRef calibration in efuse, Coding Scheme None
WARNING: Detected crystal freq 41.01MHz is quite different to normalized freq 40MHz. Unsupported crystal in use?
Crystal is 40MHz
MAC: 10:52:1c:5c:e5:d8
Uploading stub...
Running stub...
Stub running...
Changing baud rate to 921600
Changed.
Configuring flash size...
Auto-detected Flash size: 4MB
Flash will be erased from 0x00000000 to 0x00172fff...
Compressed 1516272 bytes to 1027948...
Wrote 1516272 bytes (1027948 compressed) at 0x00000000 in 14.8 seconds (effective 818.5 kbit/s)...
Hash of data verified.

Leaving...
Hard resetting via RTS pin...

4. Power off then power on again
